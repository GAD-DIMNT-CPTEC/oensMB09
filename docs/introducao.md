# Introdução

Neste site estão registrados todos os processos e procedimentos envolvendo o Sistema de Previsão por Conjunto (SPCON) Global do CPTEC. A fim de seja possível levar ao conhecimento de todos o histórico e o estado atual do SPCON Global, uma breve introdução sobre os desenvolvimentos passados é feita. Em sequência, é fornecida uma descrição dos procedimentos realizados a partir de Agosto de 2015 até o Fevereiro de 2023, período em que o SPCON recebeu - entre outros, atualizações em relação ao pacote de perturbações utilizado e outas pequenas melhorias relacionadas com a organização do projeto.

O SPCON Global do CPTEC teve como início de seu desenvolvimento o trabalho de dissertação de mestrado de Coutinho, 1999. Este trabalho inicial forneceu todo o framework necessário para se realizar as perturbações na condição inicial determinística através de uma análise de Funções Ortogonais Empíricas (mais detalhes adiante). O primeiro trabalho de Coutinho (1998), apresenta uma avaliação preliminar da técnica empregada, em que um conjunto de 6 análises é utilizado para integrar o modelo de circulação geral da atmosfera do CPTEC na resolução TQ0062L028 (~200x200km), utilizando o supercomputador NEC SX3. Nesta trabalho, Coutinho utilizou perturbações ótimas (ie., os autovetores associados aos maiores autovalores) obtidas durante um período de 36 horas de integração do modelo. Neste caso, foram utilizadas perturbações randômicas com distribuição Gaussiana de média zero e desvio-padrão igual a 0,6K para a temperatura e 3m/s para as componentes do vento.

Com a operacionalização do trabalho realizado por Coutinho, em 1999 o SPCON Global do CPTEC passou a ser realizado na resolução TQ0126L028 (~100kmx100km), sendo perturbados os campos de temperatura do ar e as componentes horizontais do vento, ambos sobre a faixa Equatorial. Após a implementação operacional do SPCON Global no CPTEC, diversos estudos foram realizados utilizando o sistema e avaliando o seu desempenho em diversos casos. Por exemplo, Machado et al. (2010) utilizou a técnica de previsões defasadas para avaliar a habilidade do SPCON em comparação com a técnica em operação no CPTEC; Mendonça (2008) estudou a taxa de crescimento das perturbações iniciais do SPCON; Cunningham et al. e mais recentemente Rozante et al. (2014), realizaram estudos sobre a técnica de previsão por conjunto utilizando vários modelos. Apesar do sistema de previsão por conjunto global do CPTEC ser referenciado como SPCON, outros autores fizeram referências este sistema utilizando no entanto, diferentes denominações. Por exemplo: "Ensemble Prediction System (EPS) - Machado et al., 2010", "Sistema de Previsão Global por Conjuntos (SPGC) - Lima, 2011", "Sistema de Previsão de Tempo por Conjunto (SPTC) - Mendonça, 2008 ou simplesmente oensMB09, nome utilizado para discriminar a suíte de previsão por conjunto no ambiente operacional do CPTEC.

Durante a década de 2000, algumas melhorias e estudos foram realizados utilizando o SPCON Global do CPTEC. Dentre elas, destacam-se o aumento no número de membros do conjunto de 7 para 15; perturbação de novas variáveis (eg., umidade específica e pressão em superfície) e novas regiões perturbadas (Hemisférios Norte e Sul, e setores norte e sul da América do Sul).

A partir de Agosto de 2015, foi iniciado um processo de organização das informações acerca do SPCON global do CPTEC bem como a organização dos códigos relacionados com o método de perturbações. Esta organização começou a ser feita pela necessidade de se obter o código para futuras melhorias e implementações, além de permitir que alunos de pós-graduação do INPE e outros colaboradores do CPTEC possam obter o código a partir de uma fonte apropriada e fiável (eg., repositório SVN) com documentação e histórico de revisões.

## Desenvolvimento

O Sistema de Previsão por Conjuntos Global (SPCON) do CPTEC é compreendido por um sistema de perturbações baseado em Funções Ortogonais Empíricas (EOF, em inglês) e o modelo de circulação geral da atmosfera do CPTEC. Este pacote está disponível para utilização dos funcionários, colaboradores e bolsistas do CPTEC/INPE através do [repositório no GitHub](https://github.com/GAD-DIMNT-CPTEC/oensMB09) que contém o módulo de perturbação das condições iniciais para ser utilizado em conjunto com um modelo espectral ou através de uma distribuição completa, utilizando um snapshot do modelo e o próprio sistema de perturbações.

O SPCON global foi desenvolvido em 1999 por Coutinho et al. e a operacionalização de sua primeira versão, foi feito em 2001. O sistema de perturbações baseado em Funções Ortogonais Empíricas é baseado no trabalho de Zhang e Krhishnamurti (1999) em que a técnica fora aplicada para a previsão da trajetória de furacões através de conjuntos. Neste primeira versão de Coutinho et al., (1999), apenas as variáveis de $t$, $u$ e $v$ (temperatura e componentes do vento horizontal, respectivamente) eram perturbadas partindo-se de uma condição inicial de alta resolução do NCEP. As análises eram produzidas para a integração do MCGA-CPTEC/INPE por até 15 dias na resolução espectral TQ0126L028, diariamente às 00Z e 12Z com um total de 15 membros (14 membros perturbados + 1 membro controle). Uma primeira grande revisão do SPCON-CPTEC/INPE veio a ser realizada em 2009 por Mendonça e Bonatti, com operacionalização prevista entre 2014/2015. Nesta primeira revisão, as variáveis $ps$ (pressão em superfície) e $q$ (umidade específica) foram adicionadas ao conjunto de perturbações. Além disso, introduziu-se também a regionalização das perturbações, isto é, diferentes parâmetros do processo de perturbação começaram a ser considerados em diferentes regiões: Hemisfério Norte, Hemisfério Sul e setores norte e sul da América do Sul. Assim como a versão original de Coutinho et al., (1999), as previsões tinham validade de até 15 dias, sendo realizadas duas vezes ao dia (00Z e 12Z) e na resolução TQ0126L28. Em 2013, uma segunda revisão foi realizada no SPCON global. Esta nova revisão foi motivada pelos resultados apresentados no artigo intitulado "Comparing TIGGE multimodel forecasts with reforecast-calibrated ECMWF ensemble forecasts", de Hagedorn et al. (2012). Neste artigo, são comparados diversos centros que produzem previsões por conjuntos e que participam do THORPEX Interactive Grand Global Ensemble (TIGGE), sendo o SPCON global do CPTEC um dos centros participantes. Os resultados mostram que o desempenho do SPCON global do CPTEC, em comparação com o MetOffice, ECMWF, NCEP, JMA e KMA, estava aquém dos demais centros apresentado um índice de previsibilidade (CRPSS) de apenas 5 dias (considerando as previsões de até 15 dias), enquanto que os demais centros apresentavam um índice superior a 6 dias. 

De fato, MetOffice, NCEP e ECMWF apresentaram índices mínimos de 12 dias. Isto significa que o limite da previsão útil (de até 15 dias) do CPTEC era de apenas 5 dias, enquanto que os demais centros citados, era de no mínimo 12 dias. Em resposta a este resultado, a segunda revisão do SPCON-CPTEC/INPE realizada por Cunningham et al. (2014), incluiu a correção de viés. A correção de viés é uma técnica pouco discutida entre os meios operacionais, seja na previsão de tempo, tempo estendido e até mesmo na assimilação de dados. Em linhas gerais, a correção de viés tem por objetivo remover o erro sistemático da previsão de tempo realizada utilizando para isto um histórico de previssões passadas. Há diferentes formas de se aplicar a correção de viés (uma explanação do que foi aplicado no SPCON global do pode ser encontrada em Cunninham et al.(2014)). Com esta revisão, Cunningham et al. mostraram que o limite de previsibilidade das previsões de até 15 dias do CPTEC passou (por exemplo, para Temperatura do Ar em 850hPa sobre o Hemisfério Sul) de 6 para 10 dias, sendo portanto, equiparável aos demais centros.

Em 2016, o SPCON-CPTEC/INPE permanece sendo realizado operacionalmente às 00Z e 12Z, na resolução espectral TQ0126L028, com 15 membros, para previsões de até 15 dias e utilizando o método de perturbação introduzido por Coutinho et al. (1999, denominado de OPER) e com as contribuições trazidas por Mendonça e Bonatti (2009). A correção de viés, embora tenha mostrado bons resultados, ainda não foi passada à operação devido a problemas com o custo computacional (comunicação pessoal Alex Fernandes). Apesar disso, em Maio de 2016, foi completada a migração para a pré-operação desta última revisão (com as melhorias de Mendonça e Bonatti, mas sem a correção de viés), utilizando a mesma versão do MCGA que foi utilizada por Mendonça e Bonatti.

Com o anúncio da nova versão do modelo de circulação geral da atmosfera do CPTEC (Brazilian Atmospheric Model - BAM), novos testes estão sendo realizados a fim de que uma nova revisão do SPCON global do CPTEC possa ser lançada, contendo o método de perturbações na sua versão atual, utilizando o BAM em conjunto com a correção de viés e possivelmente com uma nova resolução. Esta nova versão deverá estar para a segunda quinzena de Novembro de 2016.

O algorítmo empregado para a perturbação, consiste em:

1. $n$ pequenas perturbações randômicas (atualmente $n = 7$) são adicionadas aos campos de temperatura e componente horizontal do vento da análise controle (não perturbada - o SPCON do global utiliza como análise controle uma análise determinística do NCEP, válida para as 00 e 12Z). Estas perturbações obedecem a uma distribuição Gaussiana com média zero e desvio-padrão comparável ao erro carcacterístico da previsão de 3 horas (eg., 3m/s para o campo de vento; 0,6K para o campo de temperatura do ar);
2. As análises perturbadas resultantes e a controle são utilizadas para integrar o modelo por 36 horas, com resultados salvos a cada 3 horas;
3. $n$ séries temporais resultantes das diferenças entre os campos de previsão controle e perturbado são construídas subtraindo-se a previsão controle das previsões perturbadas a cada 3 horas;
4. A análise de Funções Ortogonais Empíricas (EOF) é aplicada em cada uma das séries de diferenças sobre a região tropical, de forma a determinar os autovetores com os coeficientes que crescem mais rápido com o tempo. Estes autovetores são considerados como as perturbações ótimas;
5. As perturbações EOF são reescaladas de forma a possuírem o desvio-padrão com a mesma ordem de magnitude das perturbações iniciais;
6. As perturbações reescaladas são então somadas (prefixo P) e subtraídas (prefixo N) da análise controle e então obtém-se um conjunto de $2n$ condições iniciais perturbadas.

<figure markdown>
![Esquema do Método de Perturbações MB09](https://corsproxy.io/?https://gad-dimnt-cptec.github.io/oensMB09/figs/mpert.png)

Figura - Esquema de perturbação da condição inicial do SPCON global do CPTEC, baseado em EOFs.
</figure>

## Estrutura básica do pacote do SPCON global

O SPCON global do CPTEC é composto de um conjunto de rotinas independentes do modelo numérico de previsão de tempo. Estas rotinas tem como função realizar:

* Recomposição do coeficientes espectrais para ponto de grade;
* Decomposição das quantidades em ponto de grade em coeficientes espetrais;
* Calcular distribuições de perturbações randômicas;
* Calcular distribuições Gaussianas com base no desvio padrão do erro de cada variável perturbada;
* Calcular as os autovetores associados aos autovalores obtidos de uma análise EOF, que servirão como perturbações ótimas;
* Realizar o escalonamento das perturbações ótimas para serem somadas e subtraídas da condição inicial controle.

Em detalhes, as rotinas responsáveis por estas tarefas são as seguintes:

<figure markdown>
![Diretórios do oensMB09](https://corsproxy.io/?https://gad-dimnt-cptec.github.io/oensMB09/figs/dirs.png)

Figura - Organização dos diretórios componentes do oensMB09.
</figure>

O diretório [`config`](https://github.com/GAD-DIMNT-CPTEC/oensMB09/tree/master/config) contém o arquivo `Makefile.conf.<comp>` que é utilizado para determinar o tipo de compilador a ser utilizado e demais opções de configuração do sistema, como por exemplo, a resolução espectral dos arquios de análise a serem lidos/escritos durante as transformações entre o espaço espectral e ponto de grade. Caso seja necessário alterar-se o tipo de compilador (eg., gnu, pgi, intel), um novo arquivo `Makefile` deverá ser criado refletindo esta alteração. O diretório [`decanl`](https://github.com/GAD-DIMNT-CPTEC/oensMB09/tree/master/decanl) contém as rotinas utilizadas para a decomposição em coeficientes espectrais dos campos de análise perturbados em ponto de grade. Cabe salientar que todas as perturbações (sejam randômicas ou aquelas consideradas ótimas, são realizadas em ponto de grade). O diretório [`deceof`](https://github.com/GAD-DIMNT-CPTEC/oensMB09/tree/master/deceof) contém as rotinas necessárias para o análise das funções ortogonais empíricas. Esta análise é realizada sobre a série temporal das diferenças entre as análises controle e respectivas previsões (de cada variável perturbada) e as análises randomicamente perturbadas e respectivas previsões (de cada variável). De fato, o procedimento `deceof` junto com o processo [`eof`](https://github.com/GAD-DIMNT-CPTEC/oensMB09/tree/master/eof) é responsável por realizar chamadas - quando conveniente, aos seguintes processos: [`eofhumi`](https://github.com/GAD-DIMNT-CPTEC/oensMB09/tree/master/eofhumi) (realiza a análise EOF sobre os campos de umidade); [`eofpres`](https://github.com/GAD-DIMNT-CPTEC/oensMB09/tree/master/eofpres) (realiza a análise EOF sobre os campos de pressão em superfície); [`eoftem`](https://github.com/GAD-DIMNT-CPTEC/oensMB09/tree/master/eoftemp) (realiza a análise EOF sobre os campos de temperatura) e [`eofwind`](https://github.com/GAD-DIMNT-CPTEC/oensMB09/tree/master/eofwind) (realiza a análise EOF sobre os campos de vento, componentes $u$ e $v$). O diretório [`fftpln`](https://github.com/GAD-DIMNT-CPTEC/oensMB09/tree/master/fftpln) contém as rotinas necessárias para as transformações espectrais utilizando a transformada rápida de Fourier. O diretório [`include`](https://github.com/GAD-DIMNT-CPTEC/oensMB09/tree/master/include/TQ0126L028) contém uma série de arquivos de configuração específicos para a resolução em que se está trabalhando. Caso seja necessário alterar-se a resolução, novos arquivos deverão ser criados (com base nos arquivos presentes da resolução TQ0126L028). Estes arquivo de configuração fazem referência direta às especificações da grade correspondente à resolução espectral. O diretório [`rdpert`](https://github.com/GAD-DIMNT-CPTEC/oensMB09/tree/master/rdpert) contém as rotinas utilizadas para se calcular e somar as perturbações randômicas à análise controle. O diretório [`recanl`](https://github.com/GAD-DIMNT-CPTEC/oensMB09/tree/master/recanl) contém as rotinas necssárias para a recomposição dos coeficientes espectrais das análises para as suas quantidades correspondentes em ponto de grade. O diretório [`recfct`](https://github.com/GAD-DIMNT-CPTEC/oensMB09/tree/master/recfct) contém as rotinas necessárias para a recomposição dos coeficientes espectrais das previsões para as suas quantidades correspondentes em ponto de grade.

## Considerações adicionais

O SPCON global do CPTEC é um sistema que tem sido aplicado para previsão de tempo estendido até 15 dias por mais de uma década no centro. Sendo o CPTEC um centro participante do TIGGE, há a necessidade de se realizar a manutenção e a modernização do SPCON global de forma que não apenas o CPTEC possa se beneficiar com os seus resultados, mas também fazer com que os outros centros participantes do TIGGE (eg., NCEP, ECMWF, CMC, JMA, KMA, UK MetOffice e outros) tenham o SPCON global do CPTEC como uma referência também. Durante os primeiros meses do ano de 2016, a Divisão de Modelagem e Desenvolvimento realizou esforços com o objetivo de se organizar os desenvolvimentos necessários a cada uma de suas suítes e a organização das versões de lançamento, com a documentação pertinente reunindo em um só lugar todas as informações do SPCON, é um resultado deste esforço.

## Referências bibliográficas

* Hagedorn et al., 2012: [Comparing TIGGE multimodel forecasts with reforecast-calibrated ECMWF ensemble forecasts](https://www.ecmwf.int/en/elibrary/9725-comparing-tigge-multi-model-forecasts-reforecast-calibrated-ecmwf-ensemble);
* Mendonça e Bonatti, 2009: [Experiments with EOF-Based Perturbation Methods and Their Impact on the CPTEC/INPE Ensemble Prediction System](https://journals.ametsoc.org/view/journals/mwre/137/4/2008mwr2581.1.xml);
* Coutinho e Bonatti, 1998: [Implementação da técnica de 'ensemble prediction' no CPTEC - Resultados Preliminares](http://mtc-m16b.sid.inpe.br/col/cptec.inpe.br/walmeida/2004/07.05.15.14/doc/Coutinho_Implementacao%20da%20tecnica%20de%20.pdf);
* Zhang e Krishnamurti, 1999: [A Perturbation Method for Hurricane Ensemble Predictions](https://journals.ametsoc.org/view/journals/mwre/127/4/1520-0493_1999_127_0447_apmfhe_2.0.co_2.xml)
* Lima, 2011: [Avaliação do Sistema de Previsão de Tempo Global por Conjunto do CPTEC na previsão de ciclones na sul da América do Sul](http://mtc-m16d.sid.inpe.br/col/sid.inpe.br/mtc-m19/2011/05.11.18.46/doc/publicacao.pdf);
* Machado et al., 2010: [Impacto da utilização de previsões "defasadas" no sistema de previsão de tempo por conjunto do CPTEC/INPE](https://www.scielo.br/j/rbmet/a/NDk6RMhMQHvcCDfZTFfdRwH/abstract/?lang=pt);
* Cunningham et al., 2014: [Assessing improved CPTEC probabilistic forecasts on medium-range timescale](https://rmets.onlinelibrary.wiley.com/doi/full/10.1002/met.1464).

!!! warning "Aviso"

    Este site não se destina à disseminação de produtos operacionais ou que possam ser utilizados para tomada de decisão. As informações aqui apresentadas, na forma de texto ou imagem, possuem caráter científico com a finalidade de testes ou validação. Os autores desta página não se responsabilizam pelo uso não autorizado deste material.

